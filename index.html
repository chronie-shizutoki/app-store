<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="𝙲𝚑𝚛𝚘𝚗𝚒𝚎 应用商店 - 精选实用工具，一键下载安装">
  <link rel="icon" href="icons/icon.png" type="image/png">
  <link rel="stylesheet" href="index.css">
  <title>𝙲𝚑𝚛𝚘𝚗𝚒𝚎 应用商店</title>
</head>
<body>

<!-- Top decoration -->
<header class="top-banner">
  <div class="banner-bg"></div>
  <h1 class="banner-title">𝙲𝚑𝚛𝚘𝚗𝚒𝚎 应用商店</h1>
  <p class="banner-subtitle">精选实用工具，一键下载安装</p>
</header>

<!-- App Cards -->
<div class="app-grid">
  <article class="app-card" data-json="apk/com.chronie.homemoney/output-metadata.json" data-app="家庭记账本" style="position:relative;">
    <button class="updates-button single-updates-btn" aria-label="查看更新" style="position:absolute; top:8px; right:8px; z-index:3;">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:middle;"><path d="M21 12a9 9 0 1 1-3.8-7.2"></path><polyline points="21 3 21 9 15 9"></polyline><circle cx="18.5" cy="5.5" r="2" fill="#ff4d4f" stroke="none"></circle></svg>
    </button>
    <div class="app-icon">
      <svg width="50" height="50" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><!-- 定义渐变和阴影 --><defs><!-- 高级感渐变色系 --><linearGradient id="bookGradient" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#2c3e50" /><stop offset="30%" stop-color="#34495e" /><stop offset="100%" stop-color="#2c3e50" /></linearGradient><linearGradient id="spineGradient" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#1a2530" /><stop offset="50%" stop-color="#2c3e50" /><stop offset="100%" stop-color="#1a2530" /></linearGradient><linearGradient id="pageGradient" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#f8f9fa"/><stop offset="50%" stop-color="#ffffff"/><stop offset="100%" stop-color="#f8f9fa"/></linearGradient><linearGradient id="goldGradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#f7ef8a"/><stop offset="50%" stop-color="#d4af37"/><stop offset="100%" stop-color="#b8941f"/></linearGradient><filter id="softShadow" x="-20%" y="-20%" width="140%" height="140%"><feDropShadow dx="2" dy="3" stdDeviation="2.5" flood-color="rgba(0,0,0,0.4)" flood-opacity="0.3"/></filter><filter id="subtleInnerShadow"><feDropShadow dx="1" dy="1" stdDeviation="0.8" flood-color="rgba(0,0,0,0.15)"/></filter><linearGradient id="shine" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-        <linearGradient id="pageGradient" x1="0%" y1="0%" x2="100%" y2="0%">            <stop offset="0%" stop-color="#f8f9fa" />            <stop offset="50%" stop-color="#ffffff" />            <stop offset="100%" stop-color="#f8f9fa" />        </linearGradient>                <!-- 金色渐变 -->        <linearGradient id="goldGradient" x1="0%" y1="0%" x2="100%" y2="100%">            <stop offset="0%" stop-color="#f7ef8a" />            <stop offset="50%" stop-color="#d4af37" />            <stop offset="100%" stop-color="#b8941f" />        </linearGradient>                <!-- 柔和阴影 -->        <filter id="softShadow" x="-20%" y="-20%" width="140%" height="140%">            <feDropShadow dx="2" dy="3" stdDeviation="2.5" flood-color="rgba(0,0,0,0.4)" flood-opacity="0.3"/>        </filter>                <!-- 内阴影 -->        <filter id="subtleInnerShadow">            <feDropShadow dx="1" dy="1" stdDeviation="0.8" flood-color="rgba(0,0,0,0.15)"/>        </filter>                <!-- 光泽效果 -->        <linearGradient id="shine" x1="0%" y1="0%" x2="100%" y2="100%">            <stop offset="0%" stop-color="rgba(255,255,255,0.2)" />            <stop offset="50%" stop-color="rgba(255,255,255,0.05)" />            <stop offset="100%" stop-color="rgba(255,255,255,0)" />        </linearGradient>    </defs>        <!-- 书籍阴影 - 更柔和 -->    <rect x="16" y="16" width="78" height="78" rx="6" ry="6" fill="rgba(0,0,0,0.15)" filter="url(#softShadow)"/>        <!-- 书籍主体 - 深色系提升质感 -->    <rect x="10" y="10" width="80" height="80" rx="6" ry="6" fill="url(#bookGradient)" stroke="#1a2530" stroke-width="1"/>        <!-- 光泽效果 -->    <rect x="10" y="10" width="80" height="80" rx="6" ry="6" fill="url(#shine)" stroke="none"/>        <!-- 书脊 - 更深的对比色 -->    <rect x="10" y="10" width="18" height="80" fill="url(#spineGradient)"/>        <!-- 书脊装饰线条 - 精简为2条 -->    <line x1="14" y1="20" x2="14" y2="80" stroke="rgba(255,255,255,0.1)" stroke-width="0.8"/>    <line x1="22" y1="20" x2="22" y2="80" stroke="rgba(255,255,255,0.1)" stroke-width="0.8"/>        <!-- 书页区域 - 更干净的白色 -->    <rect x="28" y="15" width="57" height="70" fill="url(#pageGradient)" stroke="#e8e8e8" stroke-width="0.5" filter="url(#subtleInnerShadow)"/>        <!-- 页面线条 - 更简洁，5条线 -->    <line x1="33" y1="28" x2="78" y2="28" stroke="#eaeaea" stroke-width="0.7"/>    <line x1="33" y1="38" x2="78" y2="38" stroke="#eaeaea" stroke-width="0.7"/>    <line x1="33" y1="48" x2="78" y2="48" stroke="#eaeaea" stroke-width="0.7"/>    <line x1="33" y1="58" x2="78" y2="58" stroke="#eaeaea" stroke-width="0.7"/>    <line x1="33" y1="68" x2="78" y2="68" stroke="#eaeaea" stroke-width="0.7"/>        <!-- 金色美元符号徽章 -->    <g transform="translate(72, 72)">        <!-- 外圈 -->        <circle cx="0" cy="0" r="14" fill="none" stroke="url(#goldGradient)" stroke-width="2"/>                <!-- 内圈 -->        <circle cx="0" cy="0" r="11" fill="rgba(212, 175, 55, 0.1)" stroke="url(#goldGradient)" stroke-width="1"/>                <!-- 美元符号 - 更优雅的字体效果 -->        <text x="0" y="4" font-family="Georgia, serif" font-size="16" font-weight="bold" text-anchor="middle" fill="url(#goldGradient)">$</text>                <!-- 徽章高光 -->        <circle cx="-3" cy="-3" r="4" fill="rgba(255,255,255,0.3)" stroke="none"/>    </g>        <!-- 精致装饰元素 -->    <!-- 书角装饰 -->    <circle cx="16" cy="16" r="1.5" fill="rgba(212, 175, 55, 0.6)"/>    <circle cx="84" cy="16" r="1.5" fill="rgba(212, 175, 55, 0.6)"/>    <circle cx="16" cy="84" r="1.5" fill="rgba(212, 175, 55, 0.6)"/>    <circle cx="84" cy="84" r="1.5" fill="rgba(212, 175, 55, 0.6)"/>        <!-- 页面装饰线 -->    <path d="M33,22 Q40,20 47,22" stroke="rgba(212, 175, 55, 0.4)" stroke-width="0.8" fill="none"/>    <path d="M33,76 Q40,78 47,76" stroke="rgba(212, 175, 55, 0.4)" stroke-width="0.8" fill="none"/></svg>
      </div>
    <div class="app-info">
      <h3 class="app-title">家庭记账本</h3>
      <p class="app-desc">轻松管理家庭收支，图表一目了然</p>
      <p class="android-version">Target: 36, Min: 26</p>
      <a class="app-download" href="apk/com.chronie.homemoney/app-debug.apk" download>
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px; vertical-align: middle;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
        下载 </a>
    </div>

    <div class="modal app-modal" style="display:none;">
      <div class="modal-content">
        <span class="close"></span>
        <section class="recent-updates">
          <h2 class="updates-title">更新内容 — <span class="modal-app-name">家庭记账本</span> <span class="modal-version"></span></h2>
          <div class="update-item">
            <ul class="update-list">
              加载中，请稍后...
            </ul>
          </div>
        </section>
      </div>
    </div>
  </article>

  <article class="app-card" data-json="apk/com.chronie.gift/output-metadata.json" data-app="限时福利活动" style="position:relative;">
    <button class="updates-button single-updates-btn" aria-label="查看更新" style="position:absolute; top:8px; right:8px; z-index:3;">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:middle;"><path d="M21 12a9 9 0 1 1-3.8-7.2"></path><polyline points="21 3 21 9 15 9"></polyline><circle cx="18.5" cy="5.5" r="2" fill="#ff4d4f" stroke="none"></circle></svg>
    </button>
    <div class="app-icon"><img src="icon.svg" alt="限时福利活动图标" width="50" height="50"></div>
    <div class="app-info">
      <h3 class="app-title">限时福利活动</h3>
      <p class="app-desc">获取最新福利，享受更多优惠</p>
      <p class="android-version">Target: 36, Min: 24</p>
      <a class="app-download" href="apk/com.chronie.gift/app-debug.apk" download>
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px; vertical-align: middle;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
        下载 </a>
    </div>

    <div class="modal app-modal" style="display:none;">
      <div class="modal-content">
        <span class="close"></span>
        <section class="recent-updates">
          <h2 class="updates-title">更新内容 — <span class="modal-app-name">限时福利活动</span> <span class="modal-version"></span></h2>
          <div class="update-item">
            <ul class="update-list">
              加载中，请稍后...
            </ul>
          </div>
        </section>
      </div>
    </div>
  </article>

  <article class="app-card" data-json="apk/com.chronie.universal_lancher/output-metadata.json" data-app="统一启动器" style="position:relative;">
    <button class="updates-button single-updates-btn" aria-label="查看更新" style="position:absolute; top:8px; right:8px; z-index:3;">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:middle;"><path d="M21 12a9 9 0 1 1-3.8-7.2"></path><polyline points="21 3 21 9 15 9"></polyline><circle cx="18.5" cy="5.5" r="2" fill="#ff4d4f" stroke="none"></circle></svg>
    </button>
    <div class="app-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 512 512">  <!-- 背景渐变圆形 -->  <defs>    <!-- 主渐变背景 -->    <linearGradient id="glassGradient" x1="0%" y1="0%" x2="100%" y2="100%">      <stop offset="0%" style="stop-color:#4CAF50;stop-opacity:0.3" />      <stop offset="100%" style="stop-color:#2196F3;stop-opacity:0.3" />    </linearGradient>    <!-- 高光渐变 -->    <linearGradient id="highlightGradient" x1="0%" y1="0%" x2="100%" y2="100%">      <stop offset="0%" style="stop-color:#FFFFFF;stop-opacity:0.8" />      <stop offset="100%" style="stop-color:#FFFFFF;stop-opacity:0" />    </linearGradient>    <!-- 内发光滤镜 -->    <filter id="innerGlow" x="-20%" y="-20%" width="140%" height="140%">      <feGaussianBlur stdDeviation="10" result="blur" />      <feComposite in="SourceGraphic" in2="blur" operator="over" />    </filter>  </defs>    <!-- 主要玻璃圆形 -->  <circle cx="256" cy="256" r="220"     fill="url(#glassGradient)"     stroke="rgba(255, 255, 255, 0.5)"     stroke-width="3"     filter="url(#innerGlow)"/>    <!-- 高光区域 - 右上角 -->  <ellipse cx="356" cy="156" rx="80" ry="60"     fill="url(#highlightGradient)"     opacity="0.7"/>    <!-- 半透明边框 -->  <circle cx="256" cy="256" r="210"     fill="none"     stroke="rgba(255, 255, 255, 0.3)"     stroke-width="2"/>    <!-- 中央发射按钮 -->  <circle cx="256" cy="256" r="60"     fill="rgba(255, 255, 255, 0.2)"     stroke="rgba(255, 255, 255, 0.7)"     stroke-width="2"/>    <!-- 发射按钮高光 -->  <ellipse cx="246" cy="246" rx="25" ry="20"     fill="rgba(255, 255, 255, 0.8)"     opacity="0.5"/>    <!-- 放射状线条 - 代表启动器功能 -->  <g stroke="rgba(255, 255, 255, 0.6)" stroke-width="2">    <!-- 上 -->    <line x1="256" y1="120" x2="256" y2="170" />    <circle cx="256" cy="120" r="8" fill="rgba(255, 255, 255, 0.5)" />        <!-- 右 -->    <line x1="340" y1="256" x2="390" y2="256" />    <circle cx="390" cy="256" r="8" fill="rgba(255, 255, 255, 0.5)" />        <!-- 下 -->    <line x1="256" y1="342" x2="256" y2="392" />    <circle cx="256" cy="392" r="8" fill="rgba(255, 255, 255, 0.5)" />        <!-- 左 -->    <line x1="122" y1="256" x2="172" y2="256" />    <circle cx="122" cy="256" r="8" fill="rgba(255, 255, 255, 0.5)" />        <!-- 右上 -->    <line x1="320" y1="120" x2="290" y2="160" />    <circle cx="320" cy="120" r="6" fill="rgba(255, 255, 255, 0.5)" />        <!-- 右下 -->    <line x1="320" y1="392" x2="290" y2="352" />    <circle cx="320" cy="392" r="6" fill="rgba(255, 255, 255, 0.5)" />        <!-- 左下 -->    <line x1="192" y1="392" x2="222" y2="352" />    <circle cx="192" cy="392" r="6" fill="rgba(255, 255, 255, 0.5)" />        <!-- 左上 -->    <line x1="192" y1="120" x2="222" y2="160" />    <circle cx="192" cy="120" r="6" fill="rgba(255, 255, 255, 0.5)" />  </g></svg>
      </div>
    <div class="app-info">
      <h3 class="app-title">统一启动器</h3>
      <p class="app-desc">一键聚合所有应用，快捷高效</p>
      <p class="android-version">Target: 36, Min: 24</p>
      <a class="app-download" href="apk/com.chronie.universal_lancher/app-release.apk" download>
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 6px; vertical-align: middle;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
        下载 </a>
    </div>

    <div class="modal app-modal" style="display:none;">
      <div class="modal-content">
        <span class="close"></span>
        <section class="recent-updates">
          <h2 class="updates-title">更新内容 — <span class="modal-app-name">统一启动器</span> <span class="modal-version"></span></h2>
          <div class="update-item">
            <ul class="update-list">
              加载中，请稍后...
            </ul>
          </div>
        </section>
      </div>
    </div>
  </article>
</div>

<br>

<!-- 每个应用的更新按钮与独立弹窗（由脚本填充内容） -->

<!-- 底部信息 -->
<footer class="footer-info">
  <small id="user-agent"></small>
</footer>

<script>
// 在每个应用卡上：读取 data-json，获取 versionName，填充 UI 并控制各自模态框
function findVersionName(obj){
  if(!obj) return null;
  if(typeof obj === 'object'){
    if(Object.prototype.hasOwnProperty.call(obj,'versionName') && typeof obj.versionName === 'string') return obj.versionName;
    for(const k in obj){
      try{
        const v = findVersionName(obj[k]);
        if(v) return v;
      }catch(e){/* ignore */}
    }
  }
  return null;
}

document.querySelectorAll('.app-card').forEach(card => {
  const jsonPath = card.dataset.json;
  const appName = card.dataset.app || (card.querySelector('.app-title')||{}).textContent || '';
  const versionSpan = card.querySelector('.version-placeholder');
  const modal = card.querySelector('.app-modal');
  const btn = card.querySelector('.single-updates-btn');
  const modalAppName = modal && modal.querySelector('.modal-app-name');
  const modalVersion = modal && modal.querySelector('.modal-version');

  if(modalAppName) modalAppName.textContent = appName;

  if(jsonPath){
    fetch(jsonPath).then(res => res.json()).then(data => {
      const v = findVersionName(data);
      if(v){
        const display = v.startsWith('v')? v : ('v'+v);
        if(versionSpan) versionSpan.textContent = display;
        if(modalVersion) modalVersion.textContent = display;
        // 如果需要，也可将版本同步到下载按钮文本（保持原文不破坏）
        const dl = card.querySelector('.app-download');
        if(dl && !dl.textContent.includes(display)){
          dl.appendChild(document.createTextNode(' ' + display));
        }
      } else {
        if(versionSpan) versionSpan.textContent = '未知';
      }
    }).catch(err => {
      if(versionSpan) versionSpan.textContent = '未知';
    });
  } else {
    if(versionSpan) versionSpan.textContent = '未知';
  }

  // 加载 updates.json（与 output-metadata.json 同目录）
  function loadUpdates(metaPath){
    try{
      const updatesPath = metaPath.replace(/output-metadata\.json$/,'updates.json');
      return fetch(updatesPath).then(r => { if(!r.ok) throw new Error('no updates'); return r.json(); }).catch(()=>null);
    }catch(e){ return Promise.resolve(null); }
  }

  function renderUpdates(modalEl, data){
    if(!modalEl) return;
    const list = modalEl.querySelector('.update-list');
    if(!list) return;
    list.innerHTML = '';
    if(!data || !Array.isArray(data.sections) || data.sections.length === 0){
      list.textContent = '暂无更新信息';
      return;
    }
    data.sections.forEach(section => {
      const li = document.createElement('li');
      const title = document.createElement('strong');
      title.textContent = section.title || '';
      li.appendChild(title);
      if(Array.isArray(section.items) && section.items.length){
        const innerUl = document.createElement('ul');
        section.items.forEach(it => {
          const itLi = document.createElement('li');
          itLi.textContent = it;
          innerUl.appendChild(itLi);
        });
        li.appendChild(innerUl);
      }
      list.appendChild(li);
    });
  }

  // 动画：从按钮位置放大到屏幕中心打开；关闭时反向动画回到按钮位置
  function open(){
    if(!modal) return;
    const content = modal.querySelector('.modal-content');

    // 如果 modal 在不是 body 的容器中（比如卡片），保存原位置并移动到 body
    if(modal.parentElement !== document.body){
      modal.__origParent = modal.parentElement;
      modal.__nextSibling = modal.nextSibling;
      document.body.appendChild(modal);
    }

    // 显示 modal 并先加载更新数据
    modal.style.display = 'block';
    if(jsonPath){
      loadUpdates(jsonPath).then(data => renderUpdates(modal, data));
    }

    // 确保样式和布局已经生效，然后计算位移
    // 计算位移量：从按钮中心到内容中心（都基于视口）
    content.getBoundingClientRect();
    const btnRect = btn.getBoundingClientRect();
    const contentRect = content.getBoundingClientRect();
    const dx = (btnRect.left + btnRect.width/2) - (contentRect.left + contentRect.width/2);
    const dy = (btnRect.top + btnRect.height/2) - (contentRect.top + contentRect.height/2);

    // 从按钮位置开始（小而偏移），背景透明
    content.style.transition = 'none';
    // 保持 CSS 中的 -50% 居中偏移，使用 calc(-50% + dx) 来平移到按钮中心
    content.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px)) scale(0.16)`;
    modal.style.backgroundColor = 'rgba(0,0,0,0)';
    modal.style.transition = 'background-color 260ms ease';

    // 强制回流然后过渡到中心
    content.getBoundingClientRect();
    requestAnimationFrame(()=>{
      content.style.transition = 'transform 260ms cubic-bezier(0.2,0,0,1)';
      // 恢复为居中位置：translate(-50%,-50%) 为 CSS 基线
      content.style.transform = 'translate(-50%, -50%) scale(1)';
      modal.style.backgroundColor = 'rgba(0,0,0,0.3)';
    });
    document.body.style.overflow = 'hidden';
  }

  function close(){
    if(!modal) return;
    const content = modal.querySelector('.modal-content');

    // 计算按钮到内容的位移（内容当前应位于中心）
    const btnRect = btn.getBoundingClientRect();
    const contentRect = content.getBoundingClientRect();
    const dx = (btnRect.left + btnRect.width/2) - (contentRect.left + contentRect.width/2);
    const dy = (btnRect.top + btnRect.height/2) - (contentRect.top + contentRect.height/2);

    content.style.transition = 'transform 220ms cubic-bezier(0.2,0,0,1)';
    modal.style.transition = 'background-color 220ms ease';
    // 关闭时从居中缩回到按钮位置（包括 -50% 基线）
    content.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px)) scale(0.16)`;
    modal.style.backgroundColor = 'rgba(0,0,0,0)';

    setTimeout(()=>{ 
      // 隐藏并恢复到原始位置（如果之前移动过）
      modal.style.display = 'none'; 
      document.body.style.overflow = 'auto';
      content.style.transition = '';
      content.style.transform = '';
      if(modal.__origParent){
        try{
          if(modal.__nextSibling){
            modal.__origParent.insertBefore(modal, modal.__nextSibling);
          } else {
            modal.__origParent.appendChild(modal);
          }
        }catch(e){ /* ignore */ }
        delete modal.__origParent;
        delete modal.__nextSibling;
      }
    }, 260);
  }

  if(btn) btn.addEventListener('click', open);
  const closeBtn = modal && modal.querySelector('.close');
  if(closeBtn) closeBtn.addEventListener('click', close);
  if(modal) modal.addEventListener('click', (e)=>{ if(e.target === modal) close(); });
  document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && modal && modal.style.display === 'block') close(); });
});

document.getElementById('user-agent').textContent = navigator.userAgent;
</script>